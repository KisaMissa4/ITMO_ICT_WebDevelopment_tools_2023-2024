## 1. Что такое Docker?

Docker — это платформа, которая позволяет разрабатывать, доставлять и запускать приложения в контейнерах. Контейнеры
представляют собой легковесные, автономные, исполняемые пакеты программного обеспечения, которые включают всё необходимое для
запуска: код, библиотеки, зависимости, настройки и т.д.

### Основные преимущества Docker:

- **Портативность**: Контейнеры работают одинаково на любом устройстве, где установлен Docker.
- **Изолированность**: Контейнеры не вмешиваются в процессы, происходящие в других контейнерах или в основной системе.
- **Масштабируемость**: Легко масштабировать приложение за счёт запуска дополнительных контейнеров.

## 2. Что такое Dockerfile?

Dockerfile — это сценарий сборки контейнера, который содержит инструкции для создания образа Docker. С помощью Dockerfile вы
можете описать, какие зависимости и конфигурации нужны вашему приложению.

### Пример Dockerfile:

```dockerfile
FROM huecker.io/library/python:3.11-slim

WORKDIR /app

COPY requirements.txt .

RUN pip install --no-cache -r requirements.txt

COPY . .
```

### Объяснение:

- **`FROM huecker.io/library/python:3.11-slim`**: Базовый образ, с которого начинается сборка. Это облегчённая версия Python
  3.11.
- **`WORKDIR /app`**: Устанавливает рабочую директорию `/app` внутри контейнера, куда будет копироваться ваш код.
- **`COPY requirements.txt .`**: Копирует файл `requirements.txt` из локальной файловой системы в рабочую директорию
  контейнера.
- **`RUN pip install --no-cache -r requirements.txt`**: Устанавливает зависимости из `requirements.txt` с использованием `pip`
  и без сохранения кеша.
- **`COPY . .`**: Копирует всё содержимое текущей директории (где расположен Dockerfile) в контейнер.

Dockerfile определяет, как будет собран образ вашего приложен��я. Этот образ затем можно запускать в контейнерах, предоставляя
единое, неизменяемое окружение для вашего кода.

## 3. Что такое Docker Compose?

Docker Compose — это инструмент для упрощения управления многоконтейнерными приложениями. Вместо того чтобы запускать каждый
контейнер по отдельности, `docker-compose.yml` позволяет вам описать все службы, которые требуются вашему приложению, в одном
файле, а затем запустить их одной командой.

### Пример файла `docker-compose.yml`:

```yaml
services:
  database:
    container_name: database
    image: postgres:latest
    env_file:
      - .env
    volumes:
      - pg/var/lib/postgresql/data
    ports:
      - "${POSTGRES_PORT}:5432"

  broker:
    container_name: broker
    image: redis:latest
    env_file:
      - .env
    ports:
      - "${REDIS_PORT}:6379"

  queue:
    container_name: queue
    build: .
    env_file:
      - .env
    environment:
      - POSTGRES_HOST=database
      - POSTGRES_PORT=5432
      - REDIS_HOST=broker
      - REDIS_PORT=6379
    depends_on:
      - broker
      - database
    command: python -m celery -A src.queue worker

  app:
    container_name: app
    build: .
    env_file:
      - .env
    environment:
      - POSTGRES_HOST=database
      - POSTGRES_PORT=5432
      - REDIS_HOST=broker
      - REDIS_PORT=6379
    depends_on:
      - broker
      - database
    command: python -m uvicorn src.app:app --host 0.0.0.0 --port 8000
    ports:
      - "${APP_PORT}:8000"

volumes:
  pg
```

### Объяснение:

- **`services`**: Здесь определяются контейнеры (или сервисы), которые нужны для работы приложения.
    - **`database`**: Контейнер с PostgreSQL. Используется для хранения данных приложения.
        - **`container_name: database`**: Имя контейнера.
        - **`image: postgres:latest`**: Используется последний образ PostgreSQL.
        - **`env_file: .env`**: Файл `.env` содержит переменные окружения (например, параметры подключения к базе данных).
        - **`volumes`**: Определяет тома для хранения данных, чтобы они сохранялись между перезапусками контейнера.
        - **`ports`**: Пробрасывает локальный порт для доступа к базе данных (например, 5432).

    - **`broker`**: Контейнер с Redis. Используется как брокер сообщений для Celery.
        - **`container_name: broker`**: Имя контейнера.
        - **`image: redis:latest`**: Используется последний образ Redis.
        - **`ports`**: Пробрасывает локальный порт для доступа к Redis (например, 6379).

    - **`queue`**: Контейнер для выполнения фоновых задач с использованием Celery.
        - **`build: .`**: Строится образ на основе Dockerfile.
        - **`command`**: Запускает Celery воркер для обработки задач в очереди.
        - **`depends_on`**: Указывает зависимости от других контейнеров (запускается после `broker` и `database`).

    - **`app`**: Основной контейнер с приложением, который запускается с использованием Uvicorn (FastAPI).
        - **`command`**: Команда для запуска веб-приложения через Uvicorn.
        - **`ports`**: Пробрасывает локальный порт для доступа к приложению (например, 8000).

- **`volumes`**: Определяет тома для хранения данных PostgreSQL, чтобы они сохранялись между перезапусками контейнера.

## 4. Как это работает вместе?

### Цель Dockerfile:

- Dockerfile создаёт образ вашего приложения с установленными зависимостями, что позволяет легко запускать его в любом
  окружении.

### Цель Docker Compose:

- Docker Compose управляет несколькими контейнерами, обеспечивая автоматический запуск зависимостей (например, базы данных и
  брокера сообщений) перед запуском основного приложения. Это удобно для разработки и тестирования.

### Процесс работы:

1. **Создание контейнеров**:
    - Вы запускаете все контейнеры одной командой: `docker-compose up`.
    - Docker Compose автоматически собирает образ вашего приложения и запускает все службы, такие как база данных, брокер
      сообщений и воркер.

2. **Обработка фоновых задач**:
    - Воркер (Celery) обрабатывает фоновые задачи, которые поступают от приложения через брокер (Redis).

3. **Взаимодействие с базой данных**:
    - Приложение взаимодействует с PostgreSQL через контейнер базы данных, используя подключение по сети Docker.

## 5. Преимущества использования Docker и Docker Compose:

- **Упрощённая настройка окружения**: Все зависимости (например, база данных, брокер сообщений) автоматически настраиваются и
  запускаются.
- **Универсальность**: Контейнеры можно запускать на любом сервере или локальной машине без необходимости в сложной
  конфигурации.
- **Изоляция**: Приложение и его зависимости изолированы от хостовой системы, что предотвращает конфликты версий библиотек и
  инструментов.

Docker и Docker Compose делают управление многокомпонентными приложениями лёгким и масштабируемым, улучшая процесс разработки и
тестирования.
